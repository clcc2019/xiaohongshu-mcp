# 财联社新闻 MCP 服务器

本项目在原有小红书MCP的基础上，新增了**财联社电报新闻**的获取和分析功能。

## 功能特性

### 1. 财联社新闻获取
- ✅ 获取最新的财联社电报新闻
- ✅ 根据关键词搜索新闻
- ✅ 获取新闻详情

### 2. 智能新闻分析
- ✅ **关键词提取**：自动识别金融相关关键词
- ✅ **行业识别**：识别新闻涉及的行业（科技、金融、地产、消费等）
- ✅ **股票识别**：提取相关股票代码
- ✅ **情感分析**：分析新闻情感倾向（利好/利空/中性）
- ✅ **影响分析**：评估新闻对相关行业和股票的影响
- ✅ **预测建议**：基于分析给出投资建议

### 3. 定时任务
- ✅ 定时自动获取最新新闻
- ✅ 自动分析新增新闻
- ✅ 新闻缓存机制
- ✅ 任务状态监控

## 快速开始

### 1. 安装依赖

```bash
go mod download
```

### 2. 启动服务

```bash
# 默认无头模式
go run .

# 有界面模式（调试用）
go run . -headless=false

# 自定义端口
go run . -port=:18060
```

服务将运行在：`http://localhost:18060/mcp`

### 3. 配置MCP客户端

#### Cursor 配置

在项目根目录创建 `.cursor/mcp.json`：

```json
{
  "mcpServers": {
    "cailianshe-mcp": {
      "url": "http://localhost:18060/mcp",
      "description": "财联社新闻获取与分析服务"
    }
  }
}
```

#### Claude Code CLI 配置

```bash
claude mcp add --transport http cailianshe-mcp http://localhost:18060/mcp
```

#### VSCode 配置

在 `.vscode/mcp.json` 中添加：

```json
{
  "servers": {
    "cailianshe-mcp": {
      "url": "http://localhost:18060/mcp",
      "type": "http"
    }
  }
}
```

## MCP 工具列表

### 财联社相关工具

#### 1. `fetch_cailianshe_news` - 获取最新新闻

获取财联社最新的电报新闻。

**参数：**
- `limit` (可选): 获取数量限制，默认10条

**示例：**
```
获取最新的10条财联社新闻
```

#### 2. `search_cailianshe_news` - 搜索新闻

根据关键词搜索财联社新闻。

**参数：**
- `keyword` (必需): 搜索关键词
- `limit` (可选): 获取数量限制，默认10条

**示例：**
```
搜索关于"人工智能"的财联社新闻
```

#### 3. `analyze_cailianshe_news` - 分析新闻

分析财联社新闻内容，提取关键信息并给出预测建议。

**参数：**
- `title` (必需): 新闻标题
- `content` (必需): 新闻内容
- `news_id` (可选): 新闻ID

**返回信息：**
- 关键词列表
- 相关行业
- 相关股票代码
- 情感倾向（positive/negative/neutral）
- 影响分析
- 预测建议
- 置信度

**示例：**
```
分析这条新闻：
标题：央行宣布降息25个基点
内容：中国人民银行今日宣布下调贷款市场报价利率（LPR）25个基点...
```

#### 4. `fetch_and_analyze_cailianshe_news` - 获取并分析新闻

一次性获取最新新闻并自动进行分析。

**参数：**
- `limit` (可选): 获取数量限制，默认10条

**示例：**
```
获取并分析最新的5条财联社新闻
```

#### 5. `start_cailianshe_scheduler` - 启动定时任务

启动财联社新闻定时获取任务，定期自动获取和分析最新新闻。

**参数：**
- `interval_minutes` (可选): 定时间隔（分钟），默认5分钟

**示例：**
```
启动定时任务，每3分钟获取一次最新新闻
```

#### 6. `stop_cailianshe_scheduler` - 停止定时任务

停止财联社新闻定时获取任务。

**示例：**
```
停止定时任务
```

#### 7. `get_cailianshe_scheduler_status` - 获取定时任务状态

获取财联社新闻定时任务的运行状态和缓存信息。

**返回信息：**
- 运行状态
- 缓存新闻数量
- 最后更新时间

**示例：**
```
查看定时任务状态
```

#### 8. `get_cached_cailianshe_news` - 获取缓存新闻

获取已缓存的财联社新闻（来自定时任务）。

**参数：**
- `limit` (可选): 获取数量限制，默认10条

**示例：**
```
获取缓存中的最新10条新闻
```

## 使用场景

### 场景1：实时监控财经新闻

```
1. 启动定时任务，每5分钟获取一次最新新闻
2. 系统自动分析新闻并识别重要信息
3. 查看缓存新闻，了解最新动态
```

### 场景2：特定主题研究

```
1. 搜索关键词"新能源"的相关新闻
2. 对搜索结果进行批量分析
3. 识别相关行业和股票
4. 获取投资建议
```

### 场景3：新闻深度分析

```
1. 获取最新新闻列表
2. 选择感兴趣的新闻
3. 进行详细分析
4. 查看情感倾向、影响分析和预测建议
```

## 分析结果示例

```json
{
  "analysis": {
    "news_id": "cls_20250129_001",
    "summary": "央行宣布降息25个基点 - 中国人民银行今日宣布下调贷款市场报价利率...",
    "sentiment": "positive",
    "keywords": ["央行", "降息", "货币政策", "利率"],
    "industries": ["金融", "地产", "制造"],
    "stocks": ["601398", "000001"],
    "impact": "该新闻对金融、地产、制造行业呈利好影响；可能影响股票: 601398、000001；宏观政策影响，可能波及整体市场",
    "prediction": "建议关注金融、地产、制造板块的投资机会；短期内相关标的可能有上涨动能",
    "confidence": 0.85,
    "analyzed_at": "2025-01-29T10:30:00Z"
  }
}
```

## 技术架构

### 核心模块

1. **cailianshe/fetch_news.go** - 新闻获取模块
   - 使用Rod浏览器自动化框架
   - 支持DOM解析和API拦截
   - 多种获取策略确保稳定性

2. **cailianshe/analyzer.go** - 智能分析模块
   - 关键词提取
   - 行业和股票识别
   - 情感分析
   - 影响评估
   - 预测建议生成

3. **cailianshe/scheduler.go** - 定时任务模块
   - 定时获取新闻
   - 自动分析
   - 缓存管理
   - 新新闻检测

4. **cailianshe_service.go** - 服务层
   - 业务逻辑封装
   - 统一接口

5. **cailianshe_mcp_handlers.go** - MCP处理器
   - MCP工具实现
   - 参数处理
   - 结果格式化

## 注意事项

1. **网络要求**：需要能够访问财联社网站（www.cls.cn）
2. **浏览器依赖**：首次运行会自动下载Chrome浏览器（约150MB）
3. **定时任务**：建议间隔不要太短，避免对服务器造成压力（推荐5分钟以上）
4. **分析准确性**：当前分析基于关键词匹配，置信度仅供参考，建议结合其他信息综合判断

## 兼容性

本项目保留了原有的小红书功能，所有小红书相关的MCP工具仍然可用：
- `check_login_status` - 检查小红书登录状态
- `publish_content` - 发布小红书图文内容
- `search_feeds` - 搜索小红书内容
- 等等...

## 常见问题

### Q: 获取新闻失败怎么办？
A: 检查网络连接，确保能访问财联社网站。如果问题持续，可以尝试重启服务。

### Q: 分析结果不准确？
A: 当前分析基于关键词匹配和规则，准确性有限。建议：
- 查看置信度（confidence）参考
- 结合多条新闻综合判断
- 关注官方公告和专业分析

### Q: 定时任务占用资源太多？
A: 可以：
- 增加定时间隔
- 减少每次获取的新闻数量
- 在不需要时停止定时任务

### Q: 如何集成外部AI服务？
A: 可以修改 `cailianshe/analyzer.go`，集成OpenAI、Claude等AI服务进行更深度的分析。

## 开发计划

- [ ] 集成外部AI服务（OpenAI/Claude）进行深度分析
- [ ] 支持更多财经新闻源
- [ ] 历史新闻数据存储
- [ ] 新闻趋势分析
- [ ] 股票价格关联分析
- [ ] Web界面展示

## 许可证

本项目基于原xiaohongshu-mcp项目，遵循相同的开源协议。

## 贡献

欢迎提交Issue和Pull Request！

## 联系方式

如有问题或建议，请通过GitHub Issues联系。

